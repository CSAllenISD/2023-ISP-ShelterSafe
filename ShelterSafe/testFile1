//Declared API's and Packages
import XCTest
import MapKit

class MyUITests: XCTestCase {
    
    var app: XCUIApplication!
    
    override func setUp() {
        super.setUp()
        
        continueAfterFailure = false
        
        app = XCUIApplication()
        app.launch()
    }
    
    override func tearDown() {
        app = nil
        
        super.tearDown()
    }
    
    func testMap() {
        let mapview = app.maps.element
        XCTAssertTrue(mapview.exists)
        
        let mapExpectation = expectation(for: NSPredicate(format: "annotations.count > 0"), evaluatedWith: mapview, handler: nil)
        
        let mapViewDelegate = MapViewDelegate(expectation: mapExpectation)
        mapview.delegate = mapViewDelegate
        
        waitForExpectations(timeout: 10, handler: nil)
        
        let annotation = mapViewDelegate.annotations.first
        XCTAssertTrue(annotation?.title == "San Francisco")
        XCTAssertTrue(annotation?.subtitle == "California")
    }
    
}

class MapViewDelegate: NSObject, MKMapViewDelegate {
    let expectation: XCTestExpectation
    var annotations: [MKAnnotation] = []
    
    init(expectation: XCTestExpectation) {
        self.expectation = expectation
    }
    
    func mapView(_ mapView: MKMapView, didAdd views: [MKAnnotationView]) {
        annotations = mapView.annotations
        expectation.fulfill()
    }
}

let app = XCUIApplication()
app.launch()

let testSuite = XCTestSuite(forTestCaseClass: MyUITests.self)
testSuite.run()

